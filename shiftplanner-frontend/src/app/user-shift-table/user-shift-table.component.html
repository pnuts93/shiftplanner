<section class="table-container">
  @if (!isRecordEmpty(currentAssignments)) {
    <table mat-table [dataSource]="users">
      <ng-container matColumnDef="Name" sticky="true">
        <th mat-header-cell *matHeaderCellDef>
          {{ "user_dashboard.user" | translate }}
        </th>
        <td mat-cell *matCellDef="let user">{{ user.fname }} {{ user.lname }}</td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      @for (day of days; track day) {
        <ng-container [matColumnDef]="day">
          <th mat-header-cell *matHeaderCellDef>{{ day | date : "dd" }}</th>
          <td mat-cell *matCellDef="let user">
            <mat-form-field appearance="fill">
              <mat-select
                [value]="currentAssignments[user.id][day]"
                (selectionChange)="onSelect(user, day, $event.value)"
                [disabled]="!canEditShift(user.id)"
                >
                @for (shift of getAvailableShifts(user, day); track shift) {
                  <mat-option [value]="shift.id">{{
                    "user_dashboard." + shift.label | translate
                  }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            @for (shift of shifts; track shift) {
              <div>
                @if (isWorkingShift(shift.id)) {
                  {{ "user_dashboard." + shift.label | translate }}:
                  <b>{{ shiftCount[shift.id][day] || 0 }}</b>
                }
              </div>
            }
            @for (shift of shifts; track shift) {
              <div>
                @if (isWorkingShift(shift.id)) {
                  {{ "user_dashboard.n_experienced" | translate }}
                  {{ "user_dashboard." + shift.label | translate }}:
                  <b>{{ experiencedShiftCount[day][shift.id] }}</b>
                }
              </div>
            }
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="headers; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: headers"></tr>
      <tr
        mat-footer-row
        *matFooterRowDef="headers; sticky: true"
        class="summary-row"
      ></tr>
    </table>
  } @else {
    <div class="loading">
      <mat-spinner></mat-spinner>
    </div>
  }
</section>
